import numpy as np
import pandas as pd
import yfinance as yf
import matplotlib.pyplot as plt
from sklearn.decomposition import PCA
from sklearn.preprocessing import StandardScaler
import seaborn as sns

tickers = ['AAPL', 'MSFT', 'JNJ', 'TSLA', 'WMT','JPM', 'XOM', 'NVDA', 'PG', 'BA']
data =yf.download(tickers, start='2010-01-01', end='2025-01-01')['Close']
returns = data.pct_change().dropna()

scaler = StandardScaler()
returns_scaled = scaler.fit_transform(returns)

pca = PCA()
components = pca.fit(returns_scaled)
explained_variance = pca.explained_variance_ratio_

loadings = pd.DataFrame(pca.components_.T,
                        index=returns.columns,
                        columns=[f'PC{i+1}' for i in range(len(returns.columns))])

print(loadings)


plt.figure(figsize=(10,10))
plt.plot(np.cumsum(explained_variance), marker='o', color='green')
plt.xlabel('Number of Components')
plt.ylabel('Cumulative Explained Variance')
plt.title('Explained Variance by PCA Components')
plt.grid(True)
plt.show()

plt.figure(figsize=(12, 8))
sns.heatmap(loadings.iloc[:, :10], annot=True, cmap='coolwarm', center=0)
plt.title('Heatmap of PCA Loadings')
plt.xlabel('Principal Components')
plt.ylabel('Stocks')
plt.show()
